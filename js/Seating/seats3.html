<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
  <style>

  .target {
    float: left;
    width: 2.5%;
    height: 35%;
    margin: .1%;
    padding: .2%;
    border: 1px dashed red;
  }
  #drag1 {
    width: 29px;
    height: 29px;
    border-radius: 50%;
  }

  #targetArea {
    width: 80%;
    height: 150px;
    border: 2px solid green;
  }

  .spot {
    width:35px;
    height: 35px;
    border: 1px dashed yellow;
  }
  .perpName {
    width:70%;
    height: 35px;
    border: 1px dashed yellow;
  }

  #sectionName{
    width: 130px;
    color: green;
  }

  #LEFT {
    float: left;
    width: 75%;
  }

  #RIGHT {
    float: left;
    width: 25%;
  }

  </style>
</head>
<body>

  <h2>Setting up Seating Chart</h2>
  <input type=text id=sectionName onchange="loadSection();"/>

  <div id=LEFT>
  <DIV>
    <img src="CandleLight.png" draggable="true" ondragstart="drag(event)" onclick="wholeMove()" id="drag1">
  </DIV>

  <div class="target" id=targetArea  ondrop="drop(event)" ondragover="allowDrop(event)">
    <div id=targetSectionName></div>
    <div id=targetSeats></div>
  </div>
</div>
<div id=RIGHT></div>
  <!--
  <div class="target" id="1.2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
  <div class="target" id="1.1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
-->
  <script>

  var assignmentStack = [];
  var clickStack =[];
  var people = [{
                "name":"Joey Applebaum",
                "id":"00001",
                "email":"JoeyApplebaum@gmail.com"
              },
              {
                "name":"Biffy Bimbaum",
                "id":"00002",
                "email":"BiffyBimbaum@gmail.com"
              },
              {
                "name":"Carla Cramer",
                "id":"00003",
                "email":"CarlaCramer@gmail.com"
              },
              {
                  "name":"Dov Ber Dershowitz",
                  "id":"00004",
                  "email":"DovBerDershowitz@gmail.com"
    }];

  function loadSection(){
    var targetSectionName = document.getElementById("targetSectionName");
    var sectionName = document.getElementById("sectionName");
    targetSectionName.innerHTML = sectionName.value + "<br>";
  }

  function createPeopleDiv(perp){
    var div = document.createElement("div");
    var right = document.getElementById("RIGHT");

    div.className = "perpName";
    div.id = perp.id;
    div.addEventListener("click", function(event){
      processPerp(event);
    });

    div.addEventListener("dragstart", function(event) {
      event.dataTransfer.setData("Text", event.target.id);
      event.target.style.opacity = "0.4";
    });

    div.innerHTML = perp.name + "<br>" + perp.email;
    div.style.fontSize = "12px";
    right.appendChild(div);
  }

  for (var i=0; i < people.length; i++){
      createPeopleDiv(people[i]);
  }

  function createDiv(divID){
    var div = document.createElement("div");
    var targetSeats = document.getElementById("targetSeats");

    div.className = "target";
    div.id = divID;
    div.addEventListener("drop", function(event){
      drop(event);
    });
    div.addEventListener("dragover", function(event){
      allowDrop(event);
    });
    div.addEventListener("click", function(event){
      processClick(event);
    });

    div.innerHTML = divID;
    div.style.fontSize = "12px";
    targetSeats.appendChild(div);
  }


  function allowDrop(ev) {
    ev.preventDefault();
  }


  seatNumber = 1;
  seatRow = "A";
  function drag(ev) {
    ev.dataTransfer.setData("txt", ev.target.id);
    ev.dataTransfer.setData("seat", seatNumber++);
  }

  function wholeMove(){
    var targetArea = document.getElementById("targetArea");
    targetArea.innerHTML += seatNumber + ";";
    seatNumber++;
  }

  function nextChar(c) {
      var res = c == 'z' ? 'A' : c == 'Z' ? 'A' : String.fromCharCode(c.charCodeAt(0) + 1);
      //console.log(res);
      return res;
  }

  function drop(ev) {
    ev.preventDefault();
    var data = ev.dataTransfer.getData("txt");
    var seat = ev.dataTransfer.getData("seat");
    var targetArea = document.getElementById("targetArea");
    targetArea.innerHTML += (seatRow + "-" + seatNumber + ";");
    //console.log(seatRow + ":" + seatNumber);
    if(seatNumber > 10){
      seatNumber = 1;
      seatRow = nextChar(seatRow);
    }
    //ev.target.appendChild(document.getElementById(data));
  }

  function getPerp(id){
      for(var i=0; i < people.length; i++){
        if(id == people[i].id) return i;
      }
      return -1;
  }

  var StackPointer = 0;

  function processPerp(event){
      var spot = document.getElementById(event.target.id);
      spot.innerHTML = "";
      clickStack.push(people[getPerp(event.target.id)]);
      StackPointer++;
      spot.style.background = "cyan";
      //howStack(clickStack);
  }

  function showStack(stack){
    console.log("Showing Stack");
    for (var i=0; i < stack.length; i++){
      console.log(stack[i]);
    }
  }

function getInitials(name){
  var inits = "";
    for (var i=0; i < name.trim().length; i++){
      if(i==0){
        inits = name.trim()[0];
      }
      if(name.trim()[i] == ' '){
        inits += name.trim()[i+1];
      }
    }
  return inits;
}

// Notice - StackPointer is always pointing to first EMPTY spot
// This function processes the click from the seats
var firstWithControl = true;
function processClick(event){
    var isCtrlPressed = event.ctrlKey;
    var spot = document.getElementById(event.target.id);
  // if the seat is full
    var row = event.target.id[0];
    var col = event.target.id[1] + event.target.id[2];
    console.log("[" + event.target.innerHTML.toLowerCase() == event.target.id.toLowerCase() + "]");
  // if the seat is empty
    if(StackPointer < 1) return;
    if(isCtrlPressed){
       if(firstWithControl){
          console.log("CTRL KEY: " + isCtrlPressed);
          firstWithControl = false;
          StackPointer--;
        }
    }
    else {
         StackPointer--;
         firstWithControl = true;
    }
    spot.innerHTML = getInitials(clickStack[StackPointer].name);
    spot.style.color = "blue";
    spot.style.fontSize = "10px";
    spot.style.border = "1px solid blue";
    assignmentStack.push(people[getPerp(clickStack[StackPointer].id)]);
    assignmentStack[assignmentStack.length-1].seat = event.target.id;
    if(!isCtrlPressed) clickStack.pop();
    showStack(assignmentStack);
}


var Row = "A";
for(var k=1; k < 5; k++){
      for(var i=1; i<31; i++){
        var j = i;
        if(i < 10){
          j = "0" + i;
        }
        createDiv(Row + j);
      }
      Row = nextChar(Row);
    }

// // control key
//
// var targetArea = document.getElementById("targetArea");
// targetArea.addEventListener("keydown", function(event){
//   onKeyDown(event);
// });
// targetArea.addEventListener("keyup", function(event){
//   onKeyUp(event);
// });
//
// var isCtrlPressed = false;
//
// function onKeyDown(event) {
//     console.log("onKeyDown");
//     if (event.keyCode == 17) { // Control got pressed
//         console.log("control key");
//         isCtrlPressed = true;
//     }
//     // if (event.keyCode == 83) { // "s" got pressed
//     //     // if control is pressed too execute some code
//     //     if (isCtrlPressed) {
//     //         // Your code here
//     //     }
//     // }
// }
//
// function onKeyUp(event) {
//     if (event.keyCode == 17) { // Control got pressed
//         console.log("control key up");
//         isCtrlPressed = false;
//     }
// }
  </script>

  </body>
  </html>
